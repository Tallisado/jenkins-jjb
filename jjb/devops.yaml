- project:
    name: devops
    jobs:
        - '{name}-verify'
        - '{name}-merge'

- job-template:
    name: '{name}-verify'

    project-type: freestyle

    properties:
        - github:
            url: https://github.com/inyounghackathon/devops

    scm:
      - git:
            url: https://github.com/inyounghackathon/devops
            refspec: '+refs/pull/*:refs/remotes/origin/pr/*'
            branches:
                - '${{sha1}}'
            skip-tag: true

    triggers:
        - github-pull-request:
            github-hooks: true
            trigger-phrase: 'recheck'
            permit-all: true

    wrappers:
        - ssh-agent-credentials:
            users:
                - '2733d65e-3472-48cb-b0e5-4b9230e3caf9'

    builders:
        - shell: |
            #!/bin/bash
            ssh -oStrictHostKeyChecking=no superdave@13.92.119.44 docker ps

- job-template:
    name: '{name}-merge'

    project-type: freestyle

    properties:
        - github:
            url: https://github.com/inyounghackathon/devops

    scm:
      - git:
            url: https://github.com/inyounghackathon/devops
            branches:
                - '*/master'
            skip-tag: true

    triggers:
        - github

    wrappers:
        - ssh-agent-credentials:
            users:
                - '2733d65e-3472-48cb-b0e5-4b9230e3caf9'

    builders:
        - shell: |
            #!/bin/bash
            ssh -oStrictHostKeyChecking=no superdave@13.92.119.44 'sh /home/superdave/otthack-ci/redeployDocker.sh'
